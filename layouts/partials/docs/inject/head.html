<!-- Prevent flash of wrong theme: apply saved preference before paint -->
<script>
  (function() {
    var t = localStorage.getItem('dm-theme');
    if (t === 'light' || t === 'dark') {
      document.documentElement.setAttribute('data-theme', t);
    }
    // Prevent flash of wrong sidebar state
    if (localStorage.getItem('dm-sidebar-collapsed') === '1') {
      document.documentElement.classList.add('sidebar-collapsed');
    }
  })();
</script>

<!-- Firebase initialization -->
<script>
  (function() {
    if (typeof firebase === 'undefined') return;
    // Use signInWithRedirect on localhost to avoid third-party cookie issues
    // with signInWithPopup (Chrome blocks cross-origin cookies from firebaseapp.com popup)
    var isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
    firebase.initializeApp({
      apiKey: "AIzaSyC_wfs6Ev6vMEr4imhEJ22H0MxSn8AOr_k",
      authDomain: "digital-memory-0.firebaseapp.com",
      projectId: "digital-memory-0",
      storageBucket: "digital-memory-0.firebasestorage.app",
      messagingSenderId: "722285589293",
      appId: "1:722285589293:web:94a32fd0c444b422fed9a4"
    });
    window.dmAuth = firebase.auth();
    window.dmDb = firebase.firestore();
    window.dmStorage = firebase.storage();
    window.dmGoogleProvider = new firebase.auth.GoogleAuthProvider();
    window.dmIsLocalhost = isLocalhost;

    // On localhost, check for redirect result on page load
    if (isLocalhost) {
      window.dmAuth.getRedirectResult().catch(function(err) {
        console.error('Redirect sign-in error:', err);
      });
    }
  })();
</script>
